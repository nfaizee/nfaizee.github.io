<html>
<head>
<style>
.joke {
	position: absolute;
    margin: 0px;
    display: inline-block;
    float: right;
    top: 100px;
    left: 75px;
    background: #000;
    color: white;
	width: 450px;
    height: 120px;
}

.tickler {
	position: absolute;
    margin: 0px;
    width: 350px;
    height: 40px;
    display: inline-block;
    float: right;
    top: 100px;
    left: 800px;
    background: #000;
    color: white;
    padding: 10px;
}

.download {
	position: absolute;
    top: 100px;
    left: 666px;
    color: white;
    padding: 10px;
}

.jokesizeddl {
	position: absolute;
    top: 100px;
    left: 550px;
    color: white;
    padding: 10px;
	background: black;
}

.namesizeddl {
	position: absolute;
    top: 100px;
    left: 1175px;
    color: white;
    padding: 10px;
	background: black;
}
</style>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script type="text/javascript">

     // http: //www.html5canvastutorials.com/tutorials/html5-canvas-wrap-text-tutorial/
     function wrapText(context, text, x, y, maxWidth, lineHeight) {
        var jokesword = text.split("\n");

        for (var ii = 0; ii < jokesword.length; ii++) {

            var line = "";
            var words = jokesword[ii].split(" ");

            for (var n = 0; n < words.length; n++) {
                var testLine = line + words[n] + " ";
                var metrics = context.measureText(testLine);
                var testWidth = metrics.width;

                if (testWidth > maxWidth) {
                    context.fillText(line, x, y);
                    line = words[n] + " ";
                    y += lineHeight;
                }
                else {
                    line = testLine;
                }
            }
            context.fillText(line, x, y);
            y += lineHeight;
        }
     }

     function DrawText() {

		var canvas = document.getElementById("myCanvas");
		var context = canvas.getContext("2d");
		
		var jokeSizeRef = document.getElementById("jokeSize")
		var jokeFontSize = jokeSizeRef.options[jokeSizeRef.selectedIndex].value;
		
		var nameSizeRef = document.getElementById("nameSize")
		var nameFontSize = nameSizeRef.options[nameSizeRef.selectedIndex].value;

		var maxWidth = 1240;
		var lineHeight = 60;
		var x = 640; // (canvas.width - maxWidth) / 2;
		var y = 600;
			
		var numOfLines = document.getElementById("joke").value.split("\n").length;
		 
		y = y - ((numOfLines-1)*20);

		var text = document.getElementById("joke").value;
		
		context.drawImage($('img').get(0), 0, 0);

		//setting the context
		context.fillStyle = "white";
		context.textBaseline = "middle";
		context.textAlign = "center";

		//refill tickler
		context.font = "Bold "+jokeFontSize+"px Blogger Sans";
        wrapText(context, text, x, y, maxWidth, lineHeight);
		 
		//refill tickler name
		context.font = "Bold "+nameFontSize+"px Blogger Sans";
		context.fillText(document.getElementById("tname").value,640,1260);
     }

    jQuery(document).ready(function () {
	
		var junction_font = new FontFace('Blogger Sans', 'url(./Blogger_Sans.otf)');
			junction_font.load().then(function(loaded_face) {
			document.fonts.add(loaded_face);
			document.body.style.fontFamily = '"Blogger Sans", Blogger Sans';
		}).catch(function(error) {
			console.log(error);
		// error occurred
		});

        jQuery("#joke").keyup(function () {
             DrawText();
        });
		 
		jQuery("#tname").keyup(function () {
             DrawText();
        });

		jQuery("#jokeSize").change(function() {
             DrawText();
        });	

		jQuery("#nameSize").change(function() {
             DrawText();
        });		

		var jokesel = document.getElementById('jokeSize');
		for(var i = 0; i < 100; i++) {
			var opt = document.createElement('option');
			opt.innerHTML = i;
			opt.value = i;
			jokesel.appendChild(opt);
		}
		jokesel.selectedIndex = 36;
		
		var namesel = document.getElementById('nameSize');
		for(var i = 0; i < 100; i++) {
			var opt = document.createElement('option');
			opt.innerHTML = i;
			opt.value = i;
			namesel.appendChild(opt);
		}
		namesel.selectedIndex = 32;
    });
	
	
	download_img = function(el) {
	  var image = document.getElementById("myCanvas").toDataURL("image/png");
	  el.href = image;
	};

    </script>
	
	</head>
<body>
<div id="demo" style="display:inline-block;">
	<form>
		<img style="display:none" src="http://i.imgur.com/4pjWhxH.png" align="left" crossorigin="Anonymous"/>
		<textarea  class="joke" rows="4" cols="50" id="joke" form="usrform" align="right">Enter joke here...</textarea>
		<select class="jokesizeddl" id="jokeSize"></select>
		<input class="tickler" type="text" id="tname" value="Tickler: "></input>
		<select class="namesizeddl" id="nameSize"></select>
		<a class="download" id="download" download="TinyTickler.png" href="" onclick="download_img(this);">Download</a>		
	</form>
</div>
<canvas id="myCanvas" width="1280" height="1280" align="left">
</canvas>
</body>
</html>